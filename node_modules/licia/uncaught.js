var isBrowser = require('./isBrowser');

var listeners = [];
var isOn = false;
exports = {
    start: function start() {
        isOn = true;
    },
    stop: function stop() {
        isOn = false;
    },
    addListener: function addListener(fn) {
        listeners.push(fn);
    },
    rmListener: function rmListener(fn) {
        var idx = listeners.indexOf(fn);

        if (idx > -1) {
            listeners.splice(idx, 1);
        }
    },
    rmAllListeners: function rmAllListeners() {
        listeners = [];
    }
};

if (isBrowser) {
    window.addEventListener('error', callListeners);
    window.addEventListener('unhandledrejection', function(e) {
        callListeners(e.reason);
    });
} else {
    process.on('uncaughtException', callListeners);
    process.on('unhandledRejection', callListeners);
}

function callListeners(err) {
    if (!isOn) return;

    for (var i = 0, len = listeners.length; i < len; i++) {
        listeners[i](err);
    }
}

module.exports = exports;
